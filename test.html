<!doctype html>
<html>
<head>
<meta charset="utf-8">
<link rel="icon" type="image/png" href="/assets/logo.png">
<title>Home - Dashboard</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
  :root{--bg:#000;--fg:lime;}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:monospace}
  .top{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-bottom:1px solid rgba(255,255,255,0.03)}
  #logo{height:37px;width:auto;}
  .menu-btn{cursor:pointer;width:28px;height:20px;position:relative;border:none;background:transparent}
  .menu-btn span, .menu-btn::before, .menu-btn::after{content:'';display:block;height:2px;width:100%;background:var(--fg);position:absolute;left:0;transition:.2s;}
  .menu-btn span{top:9px;}.menu-btn::before{top:0;}.menu-btn::after{bottom:0;}
  
  .sidebar{
    position:fixed;right:-260px;top:0;height:100%;width:260px;background:#050505;
    border-left:1px solid rgba(255,255,255,0.03);padding:16px;transition:right .3s ease;
    z-index:100;visibility:hidden;opacity:0;display:flex;flex-direction:column;justify-content:space-between;
  }
  .sidebar.show{right:0;visibility:visible;opacity:1}
  .menu-links{display:flex;flex-direction:column;gap:12px;margin-top:20px;}
  .menu-links a{border:1px solid var(--fg);border-radius:8px;padding:10px;text-align:center;text-decoration:none;color:var(--fg);}
  
  .content{padding:24px;text-align:center;}
  .welcome-box{
    border:1px solid var(--fg);
    padding:30px;
    margin:0 auto;
    max-width: 500px;
    border-radius:4px;
    background: linear-gradient(180deg, rgba(0,255,0,0.05) 0%, rgba(0,0,0,0) 100%);
  }

  /* DASHBOARD DESIGN */
  .dash-hello { font-size: 1.4rem; margin-bottom: 5px; }
  .dash-username { font-weight: bold; text-decoration: underline; }
  .balance-container {
    margin-top: 25px;
    border-top: 1px solid rgba(0,255,0,0.2);
    padding-top: 20px;
  }
  .btc-label { font-size: 0.75rem; color: #888; letter-spacing: 2px; }
  .btc-value { 
    font-size: 2.5rem; 
    margin: 10px 0; 
    color: var(--fg);
    text-shadow: 0 0 10px rgba(0,255,0,0.2);
  }
  .btc-symbol { font-size: 1.2rem; vertical-align: middle; margin-left: 5px; }
  
  .overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);z-index:99}
  .overlay.show{display:block}
  footer{position:fixed;bottom:0;width:100%;text-align:center;font-size:13px;padding:12px 0;border-top:1px solid rgba(255,255,255,0.03); background:#000;}
</style>

<script>
// --- CONFIGURATION ---
const SUPABASE_URL = 'YOUR_SUPABASE_URL'; 
const SUPABASE_KEY = 'YOUR_SUPABASE_ANON_KEY';
const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

function getCookie(name){
  const c = document.cookie.split('; ').find(r=>r.startsWith(name+'='))
  if(!c) return null
  try{ return JSON.parse(decodeURIComponent(c.split('=')[1])) }catch(e){ return null }
}

document.addEventListener('DOMContentLoaded', async ()=>{
  const user = getCookie('user');
  if(!user) return location.href='index.html';

  // Update static text
  document.getElementById('uname2').textContent = user.username;
  document.getElementById('dashName').textContent = user.username;

  // FETCH BALANCE FROM THE 'balances' TABLE
  async function fetchBalance() {
    try {
      const { data, error } = await _supabase
        .from('balances')
        .select('balance')
        .eq('user_id', user.id) // Using user_id as seen in your SQL results
        .single();

      if (error) throw error;
      if (data) {
        // Display with 8 decimal places for BTC
        document.getElementById('balanceDisplay').textContent = parseFloat(data.balance).toFixed(8);
      }
    } catch (err) {
      console.error("Error fetching balance:", err.message);
      document.getElementById('balanceDisplay').textContent = "0.00000000";
    }
  }

  fetchBalance();

  // Sidebar controls
  const sidebar = document.getElementById('sidebar');
  const overlay = document.getElementById('overlay');
  document.getElementById('menuBtn').onclick = () => {
    sidebar.classList.toggle('show');
    overlay.classList.toggle('show');
  };
  overlay.onclick = () => {
    sidebar.classList.remove('show');
    overlay.classList.remove('show');
  };
  document.getElementById('logout').onclick = () => {
    document.cookie = 'user=; path=/; max-age=0';
    location.href='index.html';
  };
});
</script>
</head>
<body>

  <div class="top">
    <a href="/home"><img id="logo" src="assets/logo.png" alt="Logo"></a>
    <button id="menuBtn" class="menu-btn"><span></span></button>
  </div>

  <div id="sidebar" class="sidebar">
    <div>
      <div style="font-size: 0.8rem; color: #555;">SESSION ACTIVE</div>
      <div style="margin-top:5px">User: <strong id="uname2"></strong></div>
      <div class="menu-links">
        <a href="/livechat">Live Chat</a>
        <a href="/leaks">Leaks</a>
        <a href="/shop/home">Shop</a>
      </div>
    </div>
    <button id="logout" style="border:none;background:var(--fg);color:#000;padding:10px;border-radius:8px;cursor:pointer;font-weight:bold;">LOG OUT</button>
  </div>

  <div id="overlay" class="overlay"></div>

  <div class="content">
    <div class="welcome-box">
      <div class="dash-hello">Hello, <span id="dashName" class="dash-username">...</span>.</div>
      
      <div class="balance-container">
        <div class="btc-label">AVAILABLE BALANCE</div>
        <div class="btc-value">
          <span id="balanceDisplay">0.00000000</span><span class="btc-symbol">BTC</span>
        </div>
      </div>
    </div>
  </div>

  <footer>
    Idawnâ„¢ | <a href="/contact" style="color:lime;text-decoration:none">Support</a>
  </footer>
</body>
</html>
